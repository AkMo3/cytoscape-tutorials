<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Tour of Cytoscape</title>

		<link rel="stylesheet" href="../../css/reveal.css">
		<link rel="stylesheet" href="../../css/theme/cytoscape-protocol-1.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="../../lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '../../css/print/pdf.css' : '../../css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
                
<!-- ========================================================== -->
<!-- THIS IS WHERE YOUR CONTENT BEGINS -->
                
<section>
            <h1>Pathway enrichment analysis and visualization of omics data using g:Profiler, GSEA and Enrichment Map in Cytoscape</h1>
            <p>This step-by-step protocol explains how to complete pathway enrichment analysis using <b>g:Profiler</b> (filtered gene list) and <b>GSEA</b> (unfiltered, whole genome, ranked gene list), followed by visualization and interpretation using <b>EnrichmentMap</b>.</p>
            <ul>              
                <li><a href="https://biit.cs.ut.ee/gprofiler/">g:Profiler</a><ul style="list-style-type:none"><li><i>- is a web-based thresholded pathway enrichment tool</i></li></ul></li>
                <li><a href="https://software.broadinstitute.org/gsea/index.jsp">Gene Set Enrichment Analysis(GSEA)</a><ul style="list-style-type:none"><li><i>- is a desktop application that analyzes ranked gene lists using a permutation-based test</i></li></ul></li>
                <li><a href="http://apps.cytoscape.org/apps/enrichmentmap">EnrichmentMap</a><ul style="list-style-type:none"><li><i>- is a Cytoscape app that visualizes the results from pathway enrichment analysis</i></li></ul></li>
            </ul>
                <div class="footer" style="bottom: -4em;">
    <a href="https://github.com/cytoscape/cytoscape-tutorials/wiki"><img class="plain" src="../../assets/images/cytoscape-tutorials.png" style="height:70px;opacity:0.5"></a></div> 
</section>

            <section id='Equipment'>
            <h1>Software Requirements</h1>
            <p><highlight>Tools needed for this protocol:</highlight></p>
                <ul>   
                    <li><ul style="list-style-type:none">A contemporary web browser (e.g. Chrome) for pathway enrichment analysis with g:Profiler. </ul></li>
                    <li><ul style="list-style-type:none"><a href = "http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Standard Edition</a> required to run GSEA and Cytoscape. </ul></li>
                    <li><ul style="list-style-type:none"><a href="http://www.broadinstitute.org/gsea/downloads.jsp">GSEA desktop application</a> for pathway enrichment analysis. </ul></li>
                    <li><ul style="list-style-type:none"><a href="http://cytoscape.org/download.php">Cytoscape desktop application</a> required for enrichment map visualization. Refer to the <a href="http://manual.cytoscape.org/en/stable/">manual</a> for a basic introduction. </ul></li>
                    <li><ul style="list-style-type:none">The following Cytoscape apps: </ul></li>
                    <ul><ul>
                        <li><a href="http://apps.cytoscape.org/apps/enrichmentmap">EnrichmentMap</a><i>- version 3.1 or higher,</i></li>
                        <li><a href="http://apps.cytoscape.org/apps/clustermaker2">clusterMaker2</a><i>- version 0.9.5 or higher,</i></li>
                        <li><a href="http://apps.cytoscape.org/apps/wordcloud">WordCloud</a><i>- version 3.1.0 or higher,</i></li>
                        <li><a href="http://apps.cytoscape.org/apps/autoannotate">AutoAnnotate</a><i>- version 1.2.0 or higher.</i></li>
                        <li><i>The above can be conveniently downloaded and installed together by installing the <a href="http://apps.cytoscape.org/apps/enrichmentmappipelinecollection">“EnrichmentMap Pipeline Collection” </a> from the Cytoscape App Store.</i></li>
                        </ul></ul>              
                </ul>   
            </section>
                
            
                
            <!-- The section tag defines one slide. The "highlight" tag is used for important text. -->
            <section id='data_gprofiler'>
            <h1>Data</h1>
            <p>We provide downloadable example files referred throughout the protocol (You can also download all the data file at once <a href="https://baderlab.github.io/Cytoscape_workflows/EnrichmentMapPipeline/SupplementaryData_EM_Protocol.tar.gz">here</a>. We recommend saving all these files in a personal project data folder before starting. We also recommend creating an additional result data folder to save the files generated while performing the protocol.</p><p><highlight>The example data provided for g:Profiler:</highlight></p>
                <ul>   
                    <li>A gene list (<a href="https://biit.cs.ut.ee/gprofiler/">g:Profiler</a>)
                        <ul><ul>
                            <li><i>A list of genes with frequent somatic single nucleotide variants (SNVs) identified in The Cancer Genome Atlas (TCGA) exome sequencing data of 3,200 tumors of 12 types.The MuSiC cancer driver mutation detection software was used to find 127 cancer driver genes that displayed higher than expected mutation frequencies in cancer samples. Genes are ranked in decreasing order of significance (FDR q-value) and mutation frequency</i></li>
                            <li><i><a href="./results_data_folder/Supplementary_Table1_Cancer_drivers.txt">Supplementary_Table1_Cancer_drivers.txt</a></i></li>
                        </ul></ul>
                    </li>
                </ul>    
            </section>
                
                
            <section id="data_gsea">
            <h1>Data - continued</h1>
            <p><highlight>The example data provided for GSEA:</highlight></p>
                <ul>   
                    <li> A ranked gene list of interest(<a href="https://software.broadinstitute.org/gsea/index.jsp">GSEA</a>)
                        <ul><ul>
                            <li><i>A list of differentially expressed genes in two subtypes of ovarian cancer defined by TCGA.</i></li>
                            <li><i>An RNK file is a two-column text file with gene IDs in the first column and gene scores in the second column. All (or most) genes in the genome need to have a score and the gene IDs need to match those used in the GMT file.</i></li>
                            <li><i> <a href="./results_data_folder/Supplementary_Table2_MesenvsImmuno_RNASeq_ranks.rnk">Supplementary_Table2_MesenvsImmuno_RNASeq_ranks.rnk</a></i></li>
                            </ul></ul></li>
                    
                    <li> Pathway gene set database(<a href="http://download.baderlab.org/EM_Genesets/current_release/">Baderlab genesets</a>)
                        <ul><ul>
                            <li><i>Contains a database of pathway gene sets used for pathway enrichment analysis in the standard GMT format, downloaded from http://baderlab.org/GeneSets. This file contains pathways downloaded on July 1, 2017 from eight data sources: Gene Ontology, Reactome, Panther, NetPath, NCI, MSigDB curated gene sets (C2 collection, excluding Reactome and KEGG), MSigDB Hallmark (H collection) and HumanCyc.</i></li>
                            <li><i>A GMT file is a text file where every line represents a gene set for a single pathway. Each line includes a pathway ID, name and the list of associated genes in a tab-separated format.</i></li>
                            <li><i><a href="./results_data_folder/Supplementary_Table3_Human_GOBP_AllPathways_no_GO_iea_July_01_2017_symbol.gmt">Supplementary_Table3_Human_GOBP_AllPathways_no_GO_iea_July_01_2017_symbol.gmt</a></i></li>
                            </ul></ul></li>
                </ul>    
            </section>
            <section id="setup">
            <h1>Setup</h1>
            <p>Dowanload and install the required software.  Download the required input and output files from the supplementary materials of the protocol.</p>
            <p><highlight>Required Software:</highlight></p>
                <ol start = "1">
                    <li><ul style="list-style-type:none">Download the required input and output files from the supplementary materials of the protocol.</ul></li>
                    <ul><ol style="list-style-type:lower-roman">
                        <li>Create two directories, <b>project data folder</b> and <b>results data folder</b>.</li>
                        <li>Place all downloaded input and example output files into the project data folder. </li>
                        <li>As you progress through the protocol place any newly generated files into the results data folder.</li>
                    </ol></ul>
                    <li><ul style="list-style-type:none">Install <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java</a> Version 8 or higher if not already installed.</ul></li>
                    <li><ul style="list-style-type:none">Download the latest version of <a href="http://www.broadinstitute.org/gsea/downloads.jsp">GSEA</a>. We recommend the javaGSEA desktop application.(Free registratio is required)</ul></li>
                    <li><ul style="list-style-type:none">Download the latest version of  <a href="http://www.cytoscape.org">Cytoscape</a>. Cytoscape version 3.6.0 or higher is required.</ul></li>
                </ol>
            </section>
            
            <section id="cytoscape_apps">
            <h1>Cytoscape Setup</h1>
                <ol start = "5">
                    <li><ul style="list-style-type:none">Launch Cytoscape.  Refer to the <a href="http://manual.cytoscape.org/en/stable/">manual</a> for a basic introduction.</ul></li>
                    <ol style="list-style-type:lower-roman">
                        <li><ul style="list-style-type:none">Go to Apps --> App Store --> Show App Store.</ul></li>
                        <li><ul style="list-style-type:none">In the search bar, search for “EnrichmentMap”.</ul></li>
                        <li><ul style="list-style-type:none">In the results in the web browser, select the <highlight>EnrichmentMap Pipeline Collection</highlight>. Verify that it is version 1.0.0 or higher.</ul></li>
                        <li><ul style="list-style-type:none">Click on the Install button.</ul></li>
                        <li><ul style="list-style-type:none">Back in Cytoscape, check the list Installed Apps and verify that the apps (<a href="http://apps.cytoscape.org/apps/enrichmentmap">EnrichmentMap</a>, <a href="http://apps.cytoscape.org/apps/clustermaker2">clusterMaker2</a>, <a href="http://apps.cytoscape.org/apps/wordcloud">WordCloud</a> and <a href="http://apps.cytoscape.org/apps/autoannotate">AutoAnnotate</a>) have been installed.</ul></li>
                    </ol>
                    
                </ol>
            </section>    
                
            <section id="method">
                <h1>Determine best Pathway Analysis Method </h1>
                <p>Two major types of gene lists are used in pathway enrichment analysis of omics data. Select A or B, depending on the type of gene list you have.</p>
                <div class="column">
                <h5><highlight>A. Flat (unranked) gene lists</highlight></h5>
                    <ul><ul>
                        <li><a href="https://biit.cs.ut.ee/gprofiler/">g:Profiler</a></li>
                        <li>a statistical threshold is required.</li>
                        <li>Partial, filtered ranked gene lists can also be analyzed with g:Profiler.</li>
                        <li>Alternate tools: <a href="https://david.ncifcrf.gov/">David</a>, <a href="https://toppgene.cchmc.org/">ToppGene</a>, <a href="https://maayanlab.cloud/Enrichr/">Enrichr</a>, <a href="http://great.stanford.edu/public/html/">GREAT</a>, <a href="https://apps.cytoscape.org/apps/enrichmenttable">EnrichmentTable</a></li>
                        </ul></ul>
                </div>
                <div class="column">
                <h5><highlight>B. Ranked, whole genome gene lists</highlight></h5>
                    <ul><ul>
                        <li><a href="https://software.broadinstitute.org/gsea/index.jsp">GSEA</a></li>
                        <li>does not require prior filtering using statistical thresholds.</li>                     
                        <li>Alternate tools:<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3458527/">Camera</a>, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2922896/">Roast</a>, <a href="https://bioconductor.org/packages/release/bioc/html/GSVA.html">GSVA</a>, <a href="https://bioconductor.org/packages/release/bioc/html/fgsea.html">fGSEA</a></li>
                    </ul></ul>
                </div> 
            </section>
                
            <section id="run_gprofiler">        
                <section>
                    <h1>6A. Pathway enrichment analysis of a gene list using g:Profiler </h1>               
                    <ol style="list-style-type:lower-roman">
                        <li>Open g:Profiler</li>
                        <ul>
                            <li>Launch Browser</li>
                            <li>Open the g:Profiler website at <a href="http://biit.cs.ut.ee/gprofiler/">http://biit.cs.ut.ee/gprofiler/</a> </li> 
                        </ul>
                    </ol>
                    <br />

                </section>

                <section>
                    <h3>6A. g:Profiler - Input data and set parameters</h3>
                    <img style="float:right;width:45%" src="./figures/gprofiler_interface_step1.png">
                    <ol style="list-style-type:lower-roman;width:45%" start = "2">
                        <li>Paste the gene list (<a href="./results_data_folder/Supplementary_Table1_Cancer_drivers.txt">gprofiler_genelist_Cancer_drivers.txt</a>) into the Query field in top-left corner of the screen.</li>
                        <li>Check the box next to <b>Ordered query.</b></li>
                        <li>Check the box next to <b>No electronic GO annotations. </b></li>
                        <li>Click on Show Advanced Options </li>
                    </ol>
                </section>

                <section>
                    <h3>6A. g:Profiler - Input data and set parameters - cont'd</h3>
                    <img style="float:right;width:55%" src="./figures/gprofiler_interface_step2.png">
                    <ol start="6" style="list-style-type:lower-roman;width:35%">
                        <li>Set filters on gene annotation data using the legend on the right. We recommend that initial pathway enrichment analyses only includes biological processes (BP) of GO and molecular pathways of Reactome. Keep the two checkboxes checked and uncheck all other boxes in the legend. </li>                   
                    </ol>
                </section>                

                <section>
                    <h3>6A. g:Profiler - Input data and set parameters - cont'd</h3>
                    <div class="row">
                    <img style="float:right;width:30%" src="./figures/gprofiler_interface_step3.png">
                    <ol style="list-style-type:lower-roman;width:55%" start="7">
                        <li>Set the dropdown values of <b>Size of functional category</b> to <highlight>5 (‘min’)</highlight> and <highlight>350 (‘max’)</highlight>. Large pathways are of limited interpretative value, while numerous small pathways decrease the statistical power because of excessive multiple testing.</li>
                        <li>Set the dropdown <b>Size of query/term intersection</b> to <highlight>3</highlight>. The analysis will only consider more reliable pathways that have three or more genes in the input gene list.</li>
                        <li>Click <b>g:Profile!</b> to run the analysis.  
                            <ul>
                                <li>A graphical heat map image will be shown with detected pathways shown along the y axis (left) and associated genes of the input list shown along the x axis (top). Resulting pathways are organized hierarchically into related groups. </li>
                                
                                <li>g:Profiler returns only statistically significant pathways with p-values adjusted for multiple testing correction (called q-values).</li>
                                <li><font color="red"> By default, results with q-values below 0.05 are reported. </font></li>
                            </ul></li>
                    </ol>
                    </div>
                    <aside class="notes">
                        <ul>
                            <li>g:Profiler uses graphical output by default and switches to textual output when a large number of pathways is found.</li>
                            <li>g:Profiler reports unrecognized and ambiguous gene IDs that can be resolved manually.</li>
                        </ul>
                    </aside>
                </section>
                
                <section id="gprofiler_">
                    <h3>6A. g:Profiler - Input data and set parameters - cont'd</h3>
                    <img style="float:right;width:45%" src="./figures/gprofiler_interface_step4.png">
                    <ol style="list-style-type:lower-roman;width:45%" start="10">
                        <li>Use the dropdown menu <b>Output type</b> and select the option <highlight>Generic Enrichment Map (TAB)</highlight>. This file is required for visualizing pathway results with Cytoscape and EnrichmentMap.</li>
                        <li>Click <b>g:Profile!</b> again to run the analysis with the updated parameters.  
                            <ul>
                            <li>The required link <b>Download data in Generic Enrichment Map (GEM) format</b> will appear under the g:Profiler interface.</li>
                            </ul>
                        </li>              
                    </ol>
                </section>
                
                <section id="gprofiler_file_download">
                    <h3>6A. g:Profiler - Input data and set parameters - cont'd</h3>
                    <img style="float:right;width:30%" src="./figures/gprofiler_interface_step5.png">
                    <ol style="list-style-type:lower-roman;width:60%" start="11">
                        <li> cont'd - Download enrichment file.
                        <ul>
                            <li> Download the file from the link and save it on your computer in your <b>result data folder</b> created in <a href="#setup"><b>Step 1i</b></a>. Example results are provided in <b>Supplementary_Table4_gprofiler_results.txt</b>.</li></ul>
                        </li>
                        <li>Download the required GMT file by clicking on the link <b>name</b> at the bottom of the Advanced Options form. The GMT file is a compressed ZIP archive that contains all gene sets used by g:Profiler (e.g., <b>gprofiler_hsapiens.NAME.gmt.zip</b>). 
                            <ul>
                                <li>The gene set files are divided by data source.</li>
                                <li> Download and uncompress the ZIP archive to your project folder.</li>
                                <li>All required gene sets for this analysis will be in the file hsapiens.pathways.Name.gmt (<b>Supplementary_Table5_hsapiens.pathways.NAME.gmt</b>).</li>
                                <li> Place the saved file in your <b>result data folder</b> created in <a href="#setup"><b>Step 1i</b></a>.</li>
                            </ul>  </li>                      
                    </ol>
                </section>
            </section>
                
            <section id="run_gsea">
                <section id="gsea_interface">
                    <h1>6B. Pathway enrichment analysis of a ranked gene list using GSEA </h1>
                    <div class="row">
                    <img style="float:center;width:25%" src="./figures/gsea_logo.png">
                    <ol style="list-style-type:lower-roman;width:75%">
                        <li>Launch GSEA by opening the downloaded GSEA file (gsea.jnlp) </li>
                    </ol>
                    </div>
                </section>
                
                <section>
                    <h3>Troubleshooting - GSEA launch</h3>
                        <div class="row">
                         <font color="red"> TROUBLESHOOTING: Unable to launch GSEA</font> 
                        <ol>                    
                            <li>macOS for the first time,
                            <ul>
                                <li>error “gsea.jnlp cannot be opened because it is from an unidentified developer”.</li>
                                <li> Click on “Ok”.</li>
                                <li> Instead of double clicking on the gsea.jnlp icon/file, right click and select “open”.</li>
                                <li> The same error will appear but this time it will give you the option to “Open” or “Cancel”. Click on “Open”.</li>
                                <li> After this initial opening, subsequent double clicks on gsea.jnlp will launch GSEA without errors or warnings.</li>
                            </ul></li>
                            <li>If GSEA still fails to launch through the Java Web Start downloaded from the GSEA website,
                                <ul>
                                <li>GSEA can alternatively be launched from the command line.</li>
                                <li> Go to the GSEA download site and download javaGSEA JAR file.</li>
                                <li>  Open a command line terminal.</li>
                                <li> navigate to the directory where the file javaGSEA.jar was downloaded.</li>
                                <li> Run the command "java –Xmx4G –jar gsea-3.0.jar".</li>
                            </ul></li>
                        </ol>
                        </div>
                </section>   

                <section id="gsea_interface1">
                    <h3>6B. Pathway enrichment analysis of a ranked gene list using GSEA - cont'd </h3>
                    <img style="float:right;width:40%" src="./figures/gsea_interface1.png">
                    <p><highlight>Load the required data files into GSEA:</highlight></p>
                    <ol style="list-style-type:lower-roman;width:45%", start = "2">
                        <li>Click on <b>Load Data</b> in the top left corner in the Steps in GSEA Analysis section. </li>
                        <li>In the <b>Load Data</b> tab, click on <b>Browse for files …</b></li>
                        <li>Find your <b>project data folder</b> and select the file <b><a href="./results_data_folder/Supplementary_Table2_MesenvsImmuno_RNASeq_ranks.rnk">ranked genelist file</a></b>.</li>
                        <ul>                 
                            <li>Also select the pathway gene set definition (GMT) file using a multiple select method such as shift-click (<b><a href="./results_data_folder/Supplementary_Table3_Human_GOBP_AllPathways_no_GO_iea_July_01_2017_symbol.gmt">genesets gmt file</a></b>).</li>
                            <li> Click the <b>Choose</b> button to continue.</li>
                            <li> A message box indicates that the files were loaded successfully. Click the <b>OK</b> button to continue.  </li>
                        </ul>
                        <li>Click on <b>Run GSEAPreranked</b> in the side bar under Tools. </li>
                    </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - GMT files</h3>
                        <div class="row">
                          <ul><font color="red"> TROUBLESHOOTING: GSEA may seem non-responsive but it is actually loading in large files.</font>                    
                            <li>Possible reason:Large GMT file
                            <ul>
                                <li>It may take 5-10 seconds for GSEA to load input files. The files are loaded successfully once a message appears on the screen “Files loaded successfully: 2/2. There were no errors”.</li>
                            </ul></li>
                        </ul>                        
                       <ul><font color="red"> TROUBLESHOOTING: How to use MSigdb or alternate GMT files.</font>
                           <li>GSEA also supplies its own gene set files that are accessible directly through the GSEA interface from the MSigDB resource.</li>
                           <li>These files do not need to be imported into GSEA. When you define the GMT file, the MSigDB gene set files can be found in the first tab “Gene Matrix (from website)” of the “Select one or more genesets” dialog. The latest versions of the MSigDB gene set files are in bold but previous versions can also be accessed. To select multiple gene set files, use multi-file select by simultaneously clicking on the desired files and holding the control key on Windows or command on macOS.</li>
                        </ul>       
                        </div>
                </section>   

                <section id="gsea_interface2">
                    <h3>6B. Pathway enrichment analysis of a ranked gene list using GSEA - cont'd </h3>
                    <div class="row">
                        <p><highlight>Specify the following parameters::</highlight></p>
                        <img style="float:right;width:55%" src="./figures/gsea_interface2.png">
                        <ol style="list-style-type:lower-roman;width:35%", start = "6">
                            <li><font color="green">Gene sets database</font> – 
                                <ul>
                                    <li>click on the button (…) located to the right and wait a few seconds for the gene set selection window to appear.</li>
                                    
                                </ul>
                            </li>                     
                        </ol>
                    </div>
                    <div class="row">
                    <ul>
                                   <ul>
                            <li >Go to the <b>Gene matrix (local gmx/gmt)</b> tab using the top right arrow.</li>
                            <li>Click on the downloaded local GMT file <a href="./results_data_folder/Supplementary_Table3_Human_GOBP_AllPathways_no_GO_iea_July_01_2017_symbol.gmt">Supplementary_Table3_Human_GOBP_AllPathways_no_GO_iea_July_01_2017_symbol.gmt</a>(<a href="#data_gsea">click for info on data files</a>) and click on <b>OK</b> at the bottom of the window. </li>
                                    </ul>
                    <li style="list-style-type:none">  
                        <ol style="list-style-type:lower-roman", start = "7">
                            <li><font color="green">Number of permutations</font> – number of times that the gene sets will be randomized to create the null distribution to calculate the p-value and FDR q-value. Use the default value of 1000 permutations. </li>
                            <li><font color="green">Ranked List</font> – select the ranked gene list by clicking on the right-most arrows and highlighting the rank file(<b><a href="./results_data_folder/Supplementary_Table2_MesenvsImmuno_RNASeq_ranks.rnk">Supplementary_Table2_MesenvsImmuno_RNASeq_ranks.rnk</a></b>)(<a href="#data_gsea">click for info on data files</a>).</li>
                            <li>Click the Show button next to Basic fields to display extra options.</li>
                        </ol>
                    </li></ul>
                    </div>
                </section>
                
                <section>
                    <h3>Troubleshooting - Permutations</h3>
                        <div class="row">
                           <ul><font color="red"> TROUBLESHOOTING: Increasing the number of permutations will increase computation time.</font>                    
                            <ul>
                                <li>The higher the number of permutations, the longer the analysis will take. </li>
                                <li>To calculate the FDR q-value for each gene set, the data is randomized by permuting the genes in each gene set and recalculating the p-values for the randomized set. This parameter specifies how many times this randomization is done.</li>
                                <li> The more randomizations are performed, the more precise the FDR q-value estimation will be (to a limit, as eventually the FDR q-value will stabilize at the actual value). On a Windows machine with 16G of RAM and i7 3.4 GHz processor, an analysis with 10, 100, 500, or 1000 randomizations on our example set with above defined parameters takes 155, 224, 544, and 1012 seconds, respectively.</li>
                            </ul>
                        </ul>            
                        </div>
                </section>   

                <section id="gsea_interface3">
                    <h3>6B. Pathway enrichment analysis of a ranked gene list using GSEA - cont'd </h3>
                        <p><highlight>Specify the following parameters: cont'd</highlight></p>
                        <img style="float:right;width:40%" src="./figures/gsea_interface3.png">
                        <ol style="list-style-type:lower-roman;width:50%", start = "10">
                            <li><font color="green">Analysis name </font> – change default “my_analysis” to a specific name, for example “Mesen_vs_Immuno”. </li>
                            <li><font color="green">Max size: exclude larger sets  </font> – By default GSEA sets the upper limit to 500. Set this to 200 to remove the larger sets from the analysis. </li>
                            <li><font color="green">Save results in this folder  </font> – navigate to the folder where GSEA should save the results. We recommend you choose the result data folder created in <a href="#setup"><b>Step 1i</b></a>. Otherwise, GSEA will use the default location gsea_home/output/[date] in your home directory. </li>
                        </ol>
                </section>

                <section>
                    <h3>6B. Pathway enrichment analysis of a ranked gene list using GSEA - cont'd </h3>
                    <p><highlight>Run GSEA:</highlight></p>
                    <img style="float:right;width:60%" src="./figures/gsea_interface4.png">
                    <ol style="list-style-type:lower-roman;width:100%", start = "13">
                        <li><b>Run GSEA </b> – click on the <b>Run</b> button located at the bottom of the window. 
                            
                            <ul>
                                <li>The <b>GSEA reports</b> pane at the bottom left of the window will show the status “Running”. </li>
                                <li>It will be updated to “Success” upon completion. </li>
                                <li><font color="red">This is expected to be a long running process, depending on the speed of your computer. </font> </li> 
                            </ul>
                        </li></ol>
                </section> 
                
                <section>
                    <h3>Troubleshooting - Running GSEA </h3>
                        <div class="row">
                           <ul><font color="red"> TROUBLESHOOTING: GSEA looks non-responsive but it is actually computing enrichments.</font>
                           <li>Possible reason: No progress bar.
                           <ul>                        
                            <li>GSEA has no progress bar to indicate estimated time to completion. </li>
                            <li>A run can take a few minutes or hours depending on your data size and computer speed.</li>
                            <li> Click on the “+” in the bottom left corner of the screen to see messages such as “shuffleGeneSet for GeneSet 4661/4715 nperm: 1000” </li>
                            <li>This message indicates that GSEA is shuffling 4,715 gene sets 1,000 times each, 4,661 of which are complete. Once the permutations are complete, GSEA generates the report.</li>
                            </ul></li>
                        </ul>       
                        </div>
                </section>   
                
                <section>
                    <h3>Troubleshooting - Running GSEA </h3>
                        <div class="row">
                           <ul><font color="red"> TROUBLESHOOTING: Error message "Java Heap space".</font>
                           <li>Possible reason: GSEA was launched with insufficient memory.
                           <ul>                        
                            <li>The error message “Java Heap space” indicates that the software has run out of memory.  </li>
                            <li>Another version of GSEA is needed if you are running the Web Start application. There are multiple options available for download from the GSEA website. You can download a webstart application that launches GSEA with 1, 2, 4, or 8GB. Upgrade to a webstart that launches with more memory.</li>
                            <li>  If you are already using the webstart that launches with 8GB then you require GSEA JAVA jar file which can be executed from the command line with increased memory .</li>
                            </ul></li>
                        </ul>
                        </div>
                </section>
                
                <section>
                    <h3>6B. Pathway enrichment analysis of a ranked gene list using GSEA - cont'd </h3>
                        <div class="row">
                            <ul style="list-style-type:none">
                            <p><highlight>Examine GSEA Results:</highlight></p>
                            <ol style="list-style-type:lower-roman;width:100%", start = "14">
                                <li> Once the GSEA analysis is complete, a green notification “Success” will appear in the bottom left section of the screen. 
                                    <ul>
                                        <li>All GSEA output files will be automatically saved and available in the folder you specified in the GseaPreranked interface (<a href="#gsea_interface3">Specified in Step 6Bxii</a>).</li> 
                                        <li>Click on “Success” to open the results in your web browser.</li>
                                        <li>Pathways enriched in top-ranking genes (i.e. up-regulated) are shown in the first set (‘na_pos’; ‘mesenchymal’ in this protocol)</li>
                                        <li>Pathways enriched in bottom-ranked genes (i.e. down-regulated) in the second set (‘na_neg’; ‘immunoreactive’) </li>
                                    </ul>
                                </li>
                            </ol>
                            </ul>
                        </div>
                </section>
         <section>
                    <h3>6B. Pathway enrichment analysis of a ranked gene list using GSEA - cont'd </h3>
                        <div class="row">
                            <ul style="list-style-type:none">
                            <p><highlight>Examine GSEA Results- cont'd:</highlight></p>
                            <img style="float:right;width:30%" src="./figures/figure4A_gsea_snapshots.png">
                                <ol style="list-style-type:lower-roman", start = "15">
                                    <li>In the web browser results summary, click on the “Snapshot” link under the results to get an overview of the top 20 findings.
                                        <ul>
                                            <li>The most significant pathways for the first phenotype (‘na_pos’) should clearly display enrichment in top-ranking (i.e. up-regulated) genes (left side of the plot.</li> 
                                            <li>the most significant pathways for the second phenotype (‘na_neg’) should clearly display enrichment in bottom-ranked (i.e. down-regulated) genes (right side of the plot)</li>
                                        </ul>
                                    </li>
                                </ol>
                            </ul>
                        </div>
                </section>   
                
                <section>
                    <h3>Troubleshooting - Examining GSEA Results</h3>
                        <div class="row">
                           <ul><font color="red"> TROUBLESHOOTING: How to access previous results.</font>
                           <li>Possible reason: GSEA application was closed since running the analysis but you would like to see previous results.
                           <ul>                        
                            <li>If the GSEA software is closed, you can access previous results by opening the working folder and opening the ‘index.html’ file. </li>
                            <li> Alternatively, you can re-launch GSEA and click on “Analysis history”, then “History” and then navigate to date of your analysis.</li>
                            <li> Although all analyses, regardless of where the results files were saved, are listed under history, it is organized by date the analysis was run. If you cannot remember when you ran a specific analysis, then you may have to manually search through a few directories to find the desired analysis. </li>
                          </ul></li>
                        </ul>       
                        </div>
                </section>   
                
                <section>
                    <h3>Troubleshooting - Examining GSEA Results </h3>
                        <div class="row">    
                       <ul><font color="red"> TROUBLESHOOTING: What will GSEA use for phenotype labels in a CLS file that specifies more than two phenotypes?</font>
                           <ul>                        
                            <li>When running GSEA with expression data as input (instead of a pre-calculated rank file), a phenotype label (i.e. biological condition or sample class) is provided as input for each sample and specified in the GSEA ‘cls’ file.  </li>
                            <li>When running GSEA, the two phenotypes to compare for differential gene expression analysis are specified and these phenotypes are used in the pathway enrichment result files. </li>
                            <li> In contrast, in a GSEA preranked analysis (i.e. when a ranked gene list is provided by the user), GSEA automatically labels one phenotype “na_pos” (corresponding to enrichment in the genes at the top of the ranked list, where ‘na’ means the phenotype label is "not available") and the other “na_neg” (corresponding to enrichment in the genes at the bottom of the ranked list). This convention is also used by the EnrichmentMap software, designating the first phenotype as “positive” and the second phenotype as “negative”. </li>
                            </ul>
                        </ul>
                        </div>
                </section>   
                
                
                <section>
                    <h3>6B. Pathway enrichment analysis of a ranked gene list using GSEA - cont'd </h3>
                            <ul style="list-style-type:none">
                            <p><highlight>Examine GSEA Results- cont'd:</highlight></p>
                            <img style="float:right;width:50%" src="./figures/figure4B_gsea_results_indepth.png">
                            <ol style="list-style-type:lower-roman;width:45%", start = "16">
                                <li> In the web browser results summary, click on ‘Detailed enrichment results in HTML format’. 
                                    <ul>
                                        <li>Use the row numbering to check the number of pathways that have FDR q-values below 0.05 to determine appropriate thresholds for EnrichmentMap in the next step of the protocol.</li> 
                                        
                                    </ul>
                                </li>
                            </ol>                  
                            <ol style="list-style-type:lower-roman;width:100%">
                                <li> 
                                    <ul>
                                        <li>If no pathways are reported at q&lt; 0.05, more lenient thresholds such as q&lt;0.1 or q&lt;0.25 could be used </li>
                                        <li>The threshold q&lt;0.25 provides very lenient filtering and it is not uncommon to find thousands of enriched pathways at this level. Robust analyses should use a cutoff of q&lt; 0.05 or lower. </li>
                                        <li><font color="red">Filtering only by uncorrected p-values is not recommended. </font></li>
                                    </ul>
                                </li>
                            </ol>    
                            </ul>                     
                </section>
                 <section>
                    <h3>Troubleshooting - Examining GSEA Results </h3>
                        <div class="row">    
                       <ul><font color="red"> TROUBLESHOOTING: Few or no results returned by GSEA</font>
                           <li>Possible reason: Possible identifier mapping issue.
                           <ul>                        
                            <li>Check the number of gene sets that were analyzed. If the number is low (e.g. low hundreds), it could indicate gene ID mapping problems.</li>
                          </ul></li>
                        </ul>       
                        </div>
                </section>   
            </section>    
         
                
             <section id="visualize">
                <h1>Visualize enrichment results with EnrichmentMap </h1>
                <img style="float:right;width:55%" src="./figures/EnrichmentMap_interface.png">
                 <ol start="7" style="float:left;width:35%">
                     <li>
                        <ul style="list-style-type:none"><li>Launch the Cytoscape software. Introductory Cytoscape tutorials can be found at <a href="http://tutorials.cytoscape.org">http://tutorials.cytoscape.org</a>.</li></ul>
                     </li>
                     <li>
                        <ul style="list-style-type:none"><li>In the menu, click <b>Apps</b> --> <b>EnrichmentMap</b>. </li></ul>
                     </li>
                     <li>
                        <ul style="list-style-type:none"><li>Create <b>Enrichment Map panel</b> will appear. Creating enrichment maps with g:Profiler (<a href="#visualize_gprofiler">follow steps in 9A</a>) and GSEA (<a href="#visualize_gsea">follow steps in 9B</a>) requires different input files.</li></ul>
                     </li>
                 </ol>
            </section>
                
            <section id="visualize_gprofiler">
                <section id="visualize_gprofiler_interface1">
                    <h1>9A. Visualize enrichment results with EnrichmentMap use g:Profiler results</h1>
                    <img style="float:right;width:60%" src="./figures/em_gprofiler1.png">
                     <ol style="list-style-type:lower-roman;float:left;width:30%">
                         <li>
                            <ul style="list-style-type:none"><li>In the <b>Create Enrichment Map</b> panel, click on folder icon.</li></ul>
                         </li>
                         <li>
                            <ul style="list-style-type:none"><li>Locate and select your <b>result data folder</b> containing the g:Profiler results and click on <b>Open</b>.</li></ul>
                         </li>
                     </ol>
                    <ol style="list-style-type:lower-roman;float:left;width:100%", start=3>
                         <li>
                            <ul style="list-style-type:none"><li>In the right-hand pane g:Profiler output files will be automatically populated into their specified fields. Alternatively, users can click on the + symbol to specify each of the required files manually.</li></ul>
                         </li>
                     </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - Visualizing g:Profiler Results </h3>
                        <div class="row">    
                       <ul><font color="red"> TROUBLESHOOTING: Autoload of g:Profiler results creates many datasets with incorrect file specification.</font>
                           <li>Possible reason: There are too many text files within the directory specified.
                           <ul>                        
                            <li>To simplify loading g:Profiler results into EnrichmentMap and populating the correct fields in the EnrichmentMap interface, place the g:Profiler results file and gene set file (i.e. <b><a href="./results_data_folder/Supplementary_Table4_gprofiler_results.txt">Supplementary_Table4_gprofiler_results.txt</a></b> and <b><a href="./results_data_folder/Supplementary_Table5_hsapiens.pathways.NAME.gmt">Supplementary_Table5_hsapiens.pathways.NAME.gmt</a></b>) into a directory together by themselves. </li>
                          </ul></li>
                        </ul>       
                        </div>
                </section>   
                
                
                <section id="visualize_gprofiler_interface2">
                    <h3>9A. Visualize enrichment results with EnrichmentMap use g:Profiler results - cont'd</h3>
                    <div class="row">
                    <img style="float:right;width:45%" src="./figures/em_gprofiler2.png">
                     <ol style="list-style-type:lower-roman;float:left;width:45%" start="4">
                         <li>
                            <ul style="list-style-type:none"><li>In the right-hand pane, modify <b>Name</b> of the created data set if desired. By default, EnrichmentMap will use the name of the g:Profiler enrichment results file (e.g. <b><a href="./results_data_folder/Supplementary_Table4_gprofiler_results.txt">Supplementary_Table4_gprofiler_results.txt</a></b>).</li></ul>
                         </li>
                         <li>
                            <ul style="list-style-type:none"><li>Verify the <b>Analysis Type</b> is set to “Generic/gProfiler”.</li></ul>
                         </li>
                         <li>
                            <ul style="list-style-type:none"><li>Verify the Enrichments results file is the g:Profiler file downloaded in <a href="#gprofiler_file_download">Step 6Axi</a> (or alternatively, manually specify <b><a href="./results_data_folder/Supplementary_Table4_gprofiler_results.txt">Supplementary_Table4_gprofiler_results.txt</a></b>).</li></ul>
                         </li>
                     </ol>
                    </div>
                    <div class="row">
                        <ol style="list-style-type:lower-roman" start="7">
                            <li>
                            <ul style="list-style-type:none"><li>Verify the <b>GMT</b> specified is the file retrieved from the g:Profiler website in <a href="#gprofiler_file_download">Step 6Axii</a> . Use the file <b>hsapiens.pathways.NAME.gmt</b> (or alternately manually specify <b><a href="./results_data_folder/Supplementary_Table5_hsapiens.pathways.NAME.gmt">Supplementary_Table5_hsapiens.pathways.NAME.gmt</a></b>) that contains gene sets corresponding to GO biological processes and Reactome pathways.</li></ul>
                         </li>
                        </ol>
                    </div>
                </section>
                
                <section id="visualize_gprofiler_interface3">
                    <h3>9A. Visualize enrichment results with EnrichmentMap use g:Profiler results - cont'd</h3>
                    <div class="row">
                    <img style="float:right;width:40%" src="./figures/em_gprofiler3.png">
                     <ol style="list-style-type:lower-roman;float:left;width:50%" start="8">
                         <li>
                             <ul style="list-style-type:none"><li><b>Expressions</b> - <font color="green">(Optional)</font> Upload an expression matrix for the genes analyzed in g:Profiler or alternatively an expression data set of all genes. If the expression data set contains additional genes not used for the g:Profiler search, their expression values will still appear in the heat map of the enrichment map (for example file see <b><a href="./results_data_folder/Supplementary_Table6_TCGA_OV_RNAseq_expression.txt">Supplementary_Table6_TCGA_OV_RNAseq_expression.txt</a></b>).</li></ul></li>
                        </ol>
                    </div>
                    <div class="row">
                        <ol style="list-style-type:lower-roman" start="9">
                         <li>
                             <ul style="list-style-type:none"><li><b>Ranks</b> – <font color="green">(Optional)</font> Ranks for the gene list or the expression data can be specified (for example, see <b><a href="./results_data_folder/Supplementary_Table2_MesenvsImmuno_RNASeq_ranks.rnk">Supplementary_Table2_MesenvsImmuno_RNASeq_ranks.rnk</a></b>).</li></ul></li>
                        <li>
                            <ul style="list-style-type:none"><li><b>Classes</b> – <font color="green">(Optional)</font> GSEA CLS file defining the phenotype (i.e. biological conditions) of each sample in the expression file, for example, see <b><a href="./results_data_folder/Supplementary_Table7_TCGA_OV_RNAseq_classes.cls">Supplementary_Table7_TCGA_OV_RNAseq_classes.cls</a></b>. ).</li></ul></li>
                        <li>
                            <ul style="list-style-type:none"><li><b>Phenotypes</b> – <font color="green">(Optional)</font> If there are two different phenotypes in the expression data, update the phenotype labels so that ‘positive’ represents the phenotype associated with positive values (Mesenchymal in this example) and ‘negative’ with negative values (Immunoreactive in this example).</li></ul></li>

                         </ol>
                    </div>
                </section>
                
                <section>
                    <h3>Troubleshooting - Visualizing g:Profiler Results </h3>
                        <div class="row">    
                       <ul><font color="red"> TROUBLESHOOTING: How to create g:Profiler map with more than one phenotype.</font>
                           <li>Although an individual g:Profiler analysis only has one phenotype, it is possible to modify a single results file to contain two analyses. 
                               <ul><li>This is relevant when the phenotypes are mutually exclusive.</li>
                                   <li>For the analysis you want to associate with the additional phenotype (which would correspond to down-regulated genes in GSEA PreRanked, thus called “negative”) open the g:Profiler results file (preferably in a spreadsheet so you can easily modify a single column).</li>
                                   <li>The fifth column specifies the phenotype. Update the column to have the value of “-1” for each result in the file.</li>
                                   <li>Open the second analysis file. Copy all the results from the second file and paste them into the updated negative g:Profiler file.</li> 
                                   <li>Save the file and use it as the g:Profiler enrichment results file in the EnrichmentMap interface instead of the original results files.</li>
                                   <li>Pathways corresponding to two phenotypes will be colored red and blue in the resulting enrichment map. One limitation with this approach is that a pathway cannot be included in both positive and negative sets.</li>
                                </ul>
                           </li>
                        </ul>       
                        </div>
                </section>   
                
                <section  id="em_num_nodes_param"  >
                    <h3>9A. Visualize enrichment results with EnrichmentMap use g:Profiler results - cont'd</h3>
                    <p><highlight>Tune Parameters:</highlight></p>
                    <img style="float:right;width:40%" src="./figures/EM_number_of_nodes.png">
                     <ol style="list-style-type:lower-roman;float:left;width:50%" start="12">
                         <li><b>Number of Nodes: </b> - 
                             <ul>
                                 <li> g:Profiler returns only statistically significant results (q &lt; 0.05) by default, so the <b>FDR q-value cutoff</b> parameter can be set to 1 in the EnrichmentMap Input panel unless a more stringent filtering is desired. For this protocol, set FDR q-value to 0.01.</li>
                                 </ul></li>
                        </ol>
                    
                        <ol style="list-style-type:lower-roman;width:100%" >
                             <li><ul>
                                 <li>Select <b>Filter genes by expressions</b> to exclude any genes in the gene set definition file (i.e. the gmt file) that are not found in the supplied expression file. </li>
                                <li>If <b>Filter genes by expressions</b> is not selected, any gene that is not found in the expression file will be retained and will be presented in the expression heat map viewer with all of its associated expression values grayed out.</li></ul></li>
                        </ol>
                </section>
                
                <section id="em_num_edges_param" >
                    <h3>9A. Visualize enrichment results with EnrichmentMap use g:Profiler results - cont'd</h3>
                    <p><highlight>Tune Parameters cont'd:</highlight></p>
                    <img style="float:right;width:40%" src="./figures/EM_number_of_edges.png">
                     <ol style="list-style-type:lower-roman;float:left;width:50%" start="13">
                         <li><b>Number of Edges: </b> - 
                             <ul>
                                 <li> Keep the connectivity slider in the centre.</li>
                                 <li>If the network is too cluttered because of too many connections (edges), move the slider to the left to make the network sparser.  </li>
                                <li>Alternatively, if the network is too sparse (i.e. there are too many disconnected pathways), move the slider to the right to obtain a more densely connected network.</li></ul></li>
                        </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - Visualizing g:Profiler Results </h3>
                        <div class="row">    
                       <ul><font color="red"> TROUBLESHOOTING: What happens when you move the similarity slider bar?</font>
                                                  
                            <li>Moving the slider to the left (or right) will adjust the underlying similarity statistic threshold to make the resulting network sparser (or denser). </li>
                            <li>The slider is set with predefined defaults but users can fine-tune the similarity metric by selecting "Show advanced options" at the bottom of the "Create Enrichment Map" panel. </li>
                            <li>Predefined values appear as tick marks on the slider and include Jaccard > 0.35, Jaccard > 0.25, combined > 0.375, overlap > 0.5, overlap > 0.25. </li>                          
                        </ul>       
                        </div>
                </section>   
                
                
                <section>
                     <h3>9A. Visualize enrichment results with EnrichmentMap use g:Profiler results - cont'd</h3>
                    <div class="row">
                        <img src="./figures/EM_build.png">
                    </div>
                    <div class="row">
                     <ol style="list-style-type:lower-roman" start="14">
                         <li>Click the <b>Build</b> button at the bottom of the EnrichmentMap Input panel. A <b>Building EnrichmentMap</b> box appears and indicates the progress status. This box will disappear once the map has been created successfully.
                             </li>
                        </ol>
                    </div>
                </section>
            </section>
                
            <section id="visualize_gsea">
                <section id="visualize_gsea_interface1">
                        <h1>9B. Visualize enrichment results with EnrichmentMap use GSEA results</h1>
                        <img style="float:right;width:55%" src="./figures/em_gsea1.png">
                         <ol style="list-style-type:float:left;lower-roman;width:35%">
                             <li>
                                <ul style="list-style-type:none"><li>In the <b>Create Enrichment Map</b> panel, click on folder icon.</li></ul>
                             </li>
                             <li>
                                <ul style="list-style-type:none"><li>Locate and select your <b>result data folder</b> containing the GSEA results and click on <b>Open</b>.</li></ul>
                             </li>
                         </ol>
                    
                    <ol style="list-style-type;lower-roman;width:100%" start=3>
                             <li>
                                <ul style="list-style-type:none"><li>In the right-hand pane, GSEA output files will be auto populated into their specified fields. Alternately the + symbol can be clicked to specify each of the required files manually.</li></ul>
                             </li>
                         </ol>                 
                    </section>
                
                 <section>
                    <h3>Troubleshooting - Visualizing GSEA Results </h3>
                        <div class="row">    
                        <ul><font color="red"> TROUBLESHOOTING: How to easily create GSEA map with more than one dataset.</font>    
                                <li>If you specify a directory that contains multiple GSEA results rather than an individual GSEA results folder, EnrichmentMap will treat every GSEA results folder as its own data set. This enables easy multi-data set analyses. If you only want one data set but inadvertently selected the directory containing multiple GSEA results instead of selecting an individual folder, simply select the data sets you do not want to use and click on the trash can at the top of the EnrichmentMap input panel to remove them. </li>
                              </ul>
                        </div>
                </section>   
                
                
                <section id="visualize_gsea_interface2">
                    <h3>9B. Visualize enrichment results with EnrichmentMap use GSEA results - cont'd</h3>
                    <div class="row">
                    <img style="float:right;width:40%" src="./figures/em_gsea2.png">
                     <ol style="list-style-type:lower-roman;float:left;width:45%" start="4">
                         <li>
                            <ul style="list-style-type:none"><li>In the right-hand pane, modify <b>Name</b> of the created data set if desired. By default, EM will use the first part of the GSEA folder name prior to the last dot ‘.’ to create the data set name. For example, if the directory is called Mesen_vs_Immuno.GseaPreranked.12345, the name will be populated as Mesen_vs_Immuno.GseaPreranked.</li></ul>
                         </li>
                         <li>
                            <ul style="list-style-type:none"><li>Verify the <b>Analysis Type</b> is set to “GSEA”.</li></ul>
                         </li>
                     </ol>
                    </div>
                    <div class="row">
                        <ol style="list-style-type:lower-roman" start="6">
                            <li>
                            <ul style="list-style-type:none"><li><B>Enrichment Pos - </B>Verify that file is set to <b> [your_path_to_gsea_dir]/Mesen_vs_Immuno.GseaPreranked.12345/gsea_report_for_na_pos_12345.xls</b> where 12345 is a unique number generated by GSEA. Alternately navigate to the file <b><a href="./results_data_folder/Supplementary_Table8_gsea_report_for_na_pos.xls">Supplementary_Table8_gsea_report_for_na_pos.xls</a></b>.</li></ul>
                         </li>
                         <li>
                            <ul style="list-style-type:none"><li><B>Enrichment Neg - </B>Verify that file is set to <b>[your_path_to_gsea_dir]/Mesen_vs_Immuno.GseaPreranked.12345/gsea_report_for_na_neg_12345.xls</b> where 12345 is a unique number generated by GSEA. Alternately navigate to the file <b><a href="./results_data_folder/Supplementary_Table9_gsea_report_for_na_neg.xls">Supplementary_Table9_gsea_report_for_na_neg.xls</a></b>.</li></ul>
                         </li>
                            <li>
                            <ul style="list-style-type:none"><li>Verify the <b>GMT</b> Verify that the file is set to <b><a href="./results_data_folder/Supplementary_Table3_Human_GOBP_AllPathways_no_GO_iea_July_01_2017_symbol.gmt">Supplementary_Table3_Human_GOBP_AllPathways_no_GO_iea_July_01_2017_symbol.gmt</a></b>.</li></ul>
                         </li>
                        </ol>
                    </div>
                </section>
                
                <section>
                    <h3>Troubleshooting - Visualizing GSEA Results </h3>
                        <div class="row">    
                          <ul><font color="red"> TROUBLESHOOTING: What is the random number appended to the GSEA directory name?</font>
                           <li>Every GSEA analysis generates a random number that is appended to the names of the files and directories. The number will be different for every new analysis. 
                           </li>
                        </ul>
                        <ul><font color="red"> TROUBLESHOOTING: Enrichment map uses a GMT file that was not the original file input to GSEA.</font>
                           <li>If EnrichmentMap cannot find the original GMT file used in the GSEA analysis, it will use a filtered GMT file found in the GSEA ‘edb’ results directory. EnrichmentMap will not be able to find your original GMT file if you have moved it since running GSEA analysis. Although it is a GMT file, it has been filtered to contain only genes found in the expression file. If you use this filtered file, you will get different pathway connectivity depending on the expression data being used. You should always use the original GMT file used for the GSEA analysis and not the filtered one in the results directory. 
                           </li>
                        </ul>       
                        </div>
                </section>   
                
                <section id="visualize_gsea_interface3">
                    <h3>9B. Visualize enrichment results with EnrichmentMap use GSEA results - cont'd</h3>
                    <div class="row">
                    <img style="float:right;width:35%" src="./figures/em_gsea3.png">
                     <ol style="list-style-type:lower-roman;width:55%" start="9">
                         <li>
                             <ul style="list-style-type:none"><li><b>Ranks</b> - <font color="green">(Optional)</font> Verify that the file is set to <b><font size=4>ranked_gene_list_na_pos_versus_na_neg_12345.xls</font></b> where 12345 is a unique number generated by GSEA. Alternately, navigate to the file <b><font size=4><a href="./results_data_folder/Supplementary_Table2_MesenvsImmuno_RNASeq_ranks.rnk">Supplementary_Table2_MesenvsImmuno_RNASeq_ranks.rnk</a></font></b>).</li></ul></li>
                         <li>
                             <ul style="list-style-type:none"><li><b>Expressions</b> - <font color="green">(Optional)</font> <b><font size=4><a href="./results_data_folder/Supplementary_Table6_TCGA_OV_RNAseq_expression.txt">Supplementary_Table6_TCGA_OV_RNAseq_expression.txt</a></font></b>).</li></ul></li>
                        </ol>
                    </div>
                    <div class="row">
                        <ol style="list-style-type:lower-roman" start="11">
                            
                        <li>
                            <ul style="list-style-type:none"><li><b>Classes</b> – <font color="green">(Optional)</font> GSEA CLS file defining the phenotype (i.e. biological conditions) of each sample in the expression file, for example, see <b><font size=4><a href="./results_data_folder/Supplementary_Table7_TCGA_OV_RNAseq_classes.cls">Supplementary_Table7_TCGA_OV_RNAseq_classes.cls</a></font></b>).</li></ul></li>
                        <li>
                            <ul style="list-style-type:none"><li><b>Phenotypes</b> – <font color="green">(Optional)</font> In the text boxes replace ‘na_pos’ with ‘Mesenchymal’ and ‘na_neg’ with ‘Immunoreactive’. ‘Mesenchymal’ will be associated with red nodes as it corresponds to the positive phenotype while ‘Immunoreactive’ will be labeled blue.</li></ul></li>

                         </ol>
                    </div>
                </section>
                
                 <section>
                    <h3>Troubleshooting - Visualizing GSEA Results </h3>
                        <div class="row">    
                          <ul><font color="red"> TROUBLESHOOTING: What is the random number appended to the GSEA directory name?</font>
                           <li>Every GSEA analysis generates a random number that is appended to the names of the files and directories. The number will be different for every new analysis. 
                           </li>
                        </ul>       
                        </div>
                </section>   
                
                <section  id="em_num_nodes_param_gsea"  >
                    <h3>9B. Visualize enrichment results with EnrichmentMap use GSEA results - cont'd</h3>
                    <p><highlight>Tune Parameters:</highlight></p>
                    <img style="float:right;width:40%" src="./figures/EM_number_of_nodes.png">
                     <ol style="list-style-type:lower-roman;float:left;width:50%" start="13">
                         <li><b>Number of Nodes: </b> - 
                             <ul>
                                 <li> Set FDR q-value cutoff to 0.01. </li>
                                 <li>Select <b>Filter genes by expressions</b> to exclude any genes in the gene set definition file (i.e. the gmt file) that are not found in the supplied expression file. </li>
                                <li>If <b>Filter genes by expressions</b> is not selected, any gene that is not found in the expression file will be retained and will be presented in the expression heat map viewer with all of its associated expression values grayed out.</li></ul></li>
                        </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - Visualizing GSEA Results </h3>
                        <div class="row">    
                           <ul><font color="red"> TROUBLESHOOTING: Cannot provide a more precise value.</font>
                           <li>Scientific notation is not enabled. To set the threshold to a small number, select ‘Scientific Notation’ and set a q-value cutoff such as 1E-04.
                           </li>
                        </ul>      
                        </div>
                </section>   
                
                <section id="em_num_edges_param_gsea" >
                    <h3>9B. Visualize enrichment results with EnrichmentMap use GSEA results - cont'd</h3>
                    <p><highlight>Tune Parameters cont'd:</highlight></p>
                    <img style="float:right;width:40%" src="./figures/EM_number_of_edges.png">
                     <ol style="list-style-type:lower-roman;float:left;width:50%" start="14">
                         <li><b>Number of Edges: </b> - 
                             <ul>
                                 <li> Keep the connectivity slider in the centre.</li>
                                 <li>If the network is too cluttered because of too many connections (edges), move the slider to the left to make the network sparser.  </li>
                                <li>Alternatively, if the network is too sparse (i.e. there are too many disconnected pathways), move the slider to the right to obtain a more densely connected network.</li></ul></li>
                        </ol>
                    
                </section>
                
                <section>
                    <h3>Troubleshooting - Visualizing GSEA Results </h3>
                        <div class="row">    
                           <ul><font color="red"> TROUBLESHOOTING: What happens when you move the similarity slider bar?</font>
                                                  
                            <li>Moving the slider to the left (or right) will adjust the underlying similarity statistic threshold to make the resulting network sparser (or denser). </li>
                            <li>The slider is set with predefined defaults but users can fine-tune the similarity metric by selecting "Show advanced options" at the bottom of the "Create Enrichment Map" panel. </li>
                            <li>Predefined values appear as tick marks on the slider and include Jaccard > 0.35, Jaccard > 0.25, combined > 0.375, overlap > 0.5, overlap > 0.25. </li>                          
                        </ul>       
                        </div>
                </section>   
                
                <section>
                     <h3>9B. Visualize enrichment results with EnrichmentMap use GSEA results - cont'd</h3>
                    <div class="row">
                        <img src="./figures/EM_build.png">
                    </div>
                    <div class="row">
                     <ol style="list-style-type:lower-roman" start="15">
                         <li>Click the <b>Build</b> button at the bottom of the EnrichmentMap Input panel. A <b>Building EnrichmentMap</b> box appears and indicates the progress status. This box will disappear once the map has been created successfully.
                             </li>
                        </ol>
                    </div>
                </section>
            </section>
                
                <section id="em_anticipated_results" >
                    <h1>10. Resulting enrichment maps from g:Profiler and GSEA pipelines</h1>
                    <img src="./figures/step10_anticipated_results.png">
                </section>
            <section id=navigate>
                <section>
                    <h1>11. Navigating and interpreting the enrichment map </h1>
                    <img style="float:right;width:40%" src="./figures/em_interface1.png">
                    <ol style="list-style-type:disc;float:left;width:50%">
                         <li>An enrichment map must be interpreted to discover novel information about a data set and must be manually refined to create a publication quality figure.
                             </li>
                        <li>To explore the enrichment map, select the network of interest in the <b>Control Panel</b> located at the left side of the Cytoscape window. </li>
                        <li>The <b>Network Panel</b> can be selected using the left most tab of the <b>Control Panel.</b> </li>
                        </ol>
                    <div class="row">
                    <ol style="list-style-type:disc;">
                         
                        <li>The selected network appears in the main window, navigate to it (zoom and pan) using Cytoscape controls (<b>section A</b>) and explore the pathways by reading the gene set labels.</li>
                        <li>Pathways with many common genes often represent similar biological processes and are grouped together as sub-networks or themes in the network. Click on a node to display the corresponding genes in the table below the network view (<b>section B</b>). </li>
                        </ol>
                    </div>
                </section>
                
                 <section>
                    <h3>Troubleshooting - Navigating Results </h3>
                        <div class="row">    
                           <ul><font color="red"> TROUBLESHOOTING: Few or no pathways present in enrichment map.</font>
                           <li>A  pathway enrichment analysis resulting in few or no enriched pathways may be caused by suboptimal statistical processing used to define the original gene list. </li>
                            <li>Enriched pathways are unlikely to be found if the gene list ranks are too noisy and the most important genes are not at the top of the list, no genes are highly significant, or a large fraction of genes are highly significant. </li>
                            <li>If the gene list has been correctly defined, analyzing further databases of pathways and gene sets or setting more liberal filters may improve results.
                           </li>
                        </ul>       
                        </div>
                </section>   
                
                <section>
                    <h1>12. Find specific genes </h1>
                    <img style="float:right;width:55%" src="./figures/em_interface2.png">
                    <ol style="list-style-type:disc;float:left;width:35%">
                        <li>To find a gene or pathway of interest, type its name in the search bar located in the top right corner (<b>section C</b>). 
                             </li>
                        <li>All pathways containing that gene will be highlighted. For example, TP53 and BGN are the top genes in g:Profiler and GSEA analyses, respectively.  </li>
                        </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - Navigating Results </h3>
                        <div class="row">    
                            <ul><font color="red"> TROUBLESHOOTING: Cannot find any pathways with my search gene.</font>
                           <li>Check that the gene identifier type used for the search matches the identifier type used in the analysis.</li>
                            <li>Multiple genes separated by spaces can be entered into the search bar. Any pathway that contains the gene will be selected and highlighted in the network.   </li>
                            <li>Adding keywords “AND” into the search bar will show only pathways that contain all genes in the search query (e.g. "geneA AND geneB"). 
                           </li>
                            <li>If the original analysis did not use gene symbols then you will not be able to search by gene symbols. Instead use the identifier type that the analysis was based on, for example Entrez Gene ID or Ensembl gene ID.</li>
                        </ul>       
                        </div>
                </section>   
                
                
                <section>
                    <h1>13. Find most enriched pathways </h1>
                    <img style="float:right;width:55%" src="./figures/em_interface3.png">
                    <ol style="list-style-type:disc;float:left;width:35%">
                        <li>To find the most enriched pathways, look at the <b>Table Panel</b> located below the network view. 
                             </li>
                        <li>Select the Node Table tab (section D)</li>
                        <li> select and sort the column named “EM#_fdr_qvalue” (for g:Profiler) or “EM#_NES” (for GSEA) by clicking on the column header.  </li>
                        <li>To highlight a subset of these pathways in the network, select rows corresponding to pathways of interest, right-click on any selected row in the table and select <b>“Select nodes from selected rows”.</b> </li>
                        </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - Navigating Results </h3>
                        <div class="row">    
                           <ul><font color="red"> TROUBLESHOOTING: Very few entries in node table although the network contains many nodes.</font>
                           <li>Some nodes in the network are already selected. </li>
                            <li>If there are very few records in the node table make sure that no nodes are selected in the network. Or click on the gear icon and change the setting from “Auto” to “Show all”.</li>
                        </ul>       
                        </div>
                </section>   
                
                
                <section>
                    <h1>14. Expression Viewer</h1>
                    <img style="float:right;width:55%" src="./figures/em_heatmap1.png">
                    <ol style="list-style-type:disc;float:left;width:35%">
                        <li>When a gene expression matrix is provided as input to EnrichmentMap, we can study the expression pattern of the genes included in enriched pathways. 
                             </li>
                        <li>Click on an individual node to generate a gene expression heat map that will appear in the <b>Heat Map</b> tab of <b>Table Panel</b>.</li>
                        <li> If the analysis is based on GSEA results and a rank file is supplied, the leading edge genes will be highlighted in yellow for individual node selections. Several options for heat map visualization are available.  </li>
                        </ol>
                </section>
                
                 <section>
                    <h3>Troubleshooting - Navigating Results </h3>
                        <div class="row">    
                         <ul><font color="red"> TROUBLESHOOTING: An expression matrix was not supplied.</font>
                           <li>If no expression file is input to EnrichmentMap it will automatically create a dummy expression file where any gene found in the enrichment file will be given a placeholder expression value of 0.25, and any gene found in a pathway but not found in the enrichment results file be assigned a placeholder expression value of NA. Therefore clicking on any node in the enrichment map will show the genes used for the analysis as well as genes in the pathway that are not part of the query set.</li>
                        </ul>       
                        </div>
                </section>   
                 
                
                
                <section>
                    <h3>14. Expression Viewer - cont'd </h3>
                    <p><highlight>In the Table Panel Heat Map tab, it is possible to:</highlight></p>
                    <img style="float:right;width:55%" src="./figures/em_heatmap2.png">
                    <ol style="float:left;list-style-type:lower-roman;width:35%" start=1>
                        <li>Adjust the <b>Sort</b> option: sorting options include hierarchical clustering, ranks, or no sorting. To change the sorting option, click on the Sort button visible in the top left corner of the heat map table (<b>section A</b>).
                             </li>
                        <ol style="list-style-type:disc">
                            <li>By default, the heat map is sorted by ranks if a rank file is supplied. In the absence of a rank file, no sort is applied. Additional rank files can be uploaded for comparison through the settings menu located at the top right corner in the <b>Heat Map Panel</b> (section F). .</li>
                        </ol>
                        </ol>
                    <ol>
                        <ol style="list-style-type:disc">
                            <li> If the analysis is based on GSEA results and a rank file is supplied, the leading edge genes will be highlighted in yellow for individual node selections. Several options for heat map visualization are available.  </li>
                    </ol> </ol>
                    
                </section>
                              
                <section>
                    <h3>14. Expression Viewer - cont'd </h3>
                    <img src="./figures/em_heatmap3.png">
                    <div class="row">
                    <ol style="list-style-type:lower-roman;" start=2>          
                        <li>Define Genes you wish to visualize in the heat map (<b>section B</b>b). Data can be viewed for all genes contained in the selected nodes (union of nodes) or just for the genes common to selected nodes (intersection of nodes). By default, all genes are shown.</li>
                        <li>Change Expressions value visualization depending on your data type (<b>section C</b>). Data can be viewed as it was loaded (<b>Values</b>), or row normalized where the row mean is subtracted from every value and then divided by the row’s standard deviation (<b>Row Norm</b>), or log transformed (<b>Log</b>).</li>

                        </ol>
                    </div>
                </section>
                <section>
                    <h3>14. Expression Viewer - cont'd </h3>
                    <img src="./figures/em_heatmap4.png">
                    <div class="row">
                    <ol style="list-style-type:lower-roman;" start=4>          
                        <li><b>Compress</b> heat map columns (<b>section 8D</b>). By default, all expression values are visible as individual columns in the heat map for expression sets with less than 50 samples. It is possible to compress the data in a single column by selecting <b>Compress</b>, <b>Data Set</b> using the aggregation methods <b>Median</b>, <b>Max</b> (maximum) or <b>Min</b> (minimum). If a CLS file has been uploaded, the expression set can be compressed using one column per defined sample group using the Class option. If the expression matrix contains 50 samples or more, EnrichmentMap will automatically compress the values to their median value by default.</li>
                        <li>Check <b>Values</b> (<b>section E</b>) to show the expression numerical values in addition to the heat map color scale.</li>
                        <li>Additional fine tuning of the heat map can be done through the <b>Settings Panel</b> (<b>section F</b>) that includes functionality to add new rank files, export the heat map data as a tab delimited text file or PDF image, change the distance metric for hierarchical clustering, or turn on the node table heat map autofocus. 
</li>
                        </ol>
                    </div>
                </section>
                
                <section>
                    <h3>14. Expression Viewer - cont'd </h3>
                    <img style="float:right;width:55%" src="./figures/em_heatmap5.png">

                    <ol style="list-style-type:lower-roman;float:left;width:35%" start=7>          
                        <li>The resulting heat map. 
                            <ol style="list-style-type:disc">
                                <li>On this figure, genes are sorted using the GSEA rank file, highlighting the leading edge in yellow.</li>
                                <li>All genes contained in selected nodes are shown, </li>
                                <li>expression values are row normalized,</li>
                                <li>no compression is applied and individual expression numerical values are not shown.</li>
                                <li>Column headings are colored according to sample phenotype. Red color refers to the first phenotype (Mesenchymal), and blue to the second phenotype (Immunoreactive).</li>
                                </ol>
                        </li>
                    </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - Navigating Results </h3>
                        <div class="row">    
                           <ul><font color="red"> TROUBLESHOOTING: Heatmap column names are not colored by dataset</font>
                           <li>No CLS file loaded or mismatch between CLS file and phenotype definition.If the heat map columns are not colored for a GSEA analysis, make sure the phenotype names specified in the EnrichmentMap input panel match the class names specified in the class file (MesenchymalvsImmunoreactive_RNA-Seq_classes.cls). Also see TROUBLESHOOTING 9Bxiii.</li>
                        </ul>        
                        </div>
                </section>   
                
                <section>
                    <h3>14. Expression Viewer - cont'd </h3>
                    <img style="float:right;width:35%" src="./figures/em_heatmap6.png">

                    <ol style="list-style-type:lower-roman;float:left;width:55%" start=8>
                        <highlight>The heat map can be exported to a text file for further analysis</highlight>
                        <li>Click on the Settings icon of the heat map (<b>section F</b>) and select <b>Export as TXT</b>.
                        </li>
                        <li>If only an individual node is selected, a dialog will offer to export the Leading edge only for GSEA analysis. If selected, only the highlighted genes will be exported; otherwise, the entire set of genes is saved. </li>
                        <li>Specify the file name and location and click <b>Save</b>.</li>
                    </ol>
                </section>
                
                 <section>
                    <h3>Troubleshooting - Navigating Results </h3>
                        <div class="row">    
                           <ul><font color="red"> TROUBLESHOOTING: Option to save only leading edge genes is not given.</font>
                           <li>Selection includes more than one node or data set contains no leading edge information (i.e was not built from GSEA results)</li>
                            <li>The leading edge is only available for GSEA analyses. The option will only appear if the Enrichment map was built with GSEA results and a rank file was specified.</li>
                        </ul>         
                        </div>
                </section>   
                
                
                <section>
                    <h1>15. Organize and clarify the network </h1>
                    <img style="float:right;width:35%" src="./figures/em_clarify1.png">

                    <ol style="list-style-type:lower-roman;float:left;width:55%" start=1>
                        <li>If the network has too many nodes, go to the EnrichmentMap tab in the <b>Control Panel</b> and use the Node Cutoff Q-value threshold slider. Adjusting to a numerical value closer to 0 will remove less significant nodes (<b>section E</b>)
                        </li>
                        <li>If the network is too interconnected, go to the EnrichmentMap tab in the <b>Control Panel</b> and increasing the Edge Cutoff (Similarity) threshold will remove connections between less related nodes (<b>section F</b> ).</li>
                        <li>The network layout may be applied again after adjusting the cutoffs (see the Layout menu in Cytoscape). The default layout algorithm is the unweighted Prefuse Force Directed layout. We also recommend the prefuse force-directed layouts weighted using the gene set similarity coefficient. Alternative layout algorithms are available and we encourage experimenting with them.</li>
                        <li>To restore nodes or edges, adjust threshold sliders to their original positions.</li>
                    </ol>
                </section>
               
                <section>
                    <h3>15. Organize and clarify the network - cont'd </h3>
                    <p><highlight>Separate two different phenotypes:</highlight></p>
                    <img style="float:right;width:35%" src="./figures/em_clarify2.png">

                    <ol style="list-style-type:lower-roman;width:55%" start=5>
                        <li>It can be helpful to separate two different phenotypes (i.e. place all the red nodes to one side and all blue nodes to the other). 
                        </li>
                        <li>Go to the <b>Select tab</b> in the <b>Control Panel</b> </li>
                        <li>Click on the + symbol and select <b>Column filter</b></li>
                        <li>Click on <b>Choose column…</b> and select “EM1_NES (Mesem_vs_Immuno)”</li>
                        <li>Click on the box next to <b>between</b> and change the value to zero. Click <b>Apply</b> at the bottom of the panel.</li>
                        <li>All red nodes should now be selected. Click and hold on any selected node and drag selection to the left until it does not overlap any blue nodes.</li>
                        <li>Select <b>Layouts</b> from the Cytoscape menu and apply <b>Prefuse Force Directed Layout  -->   Selected Nodes Only  -->  (none)</b>.</li>
                    </ol>
                  
                </section>
                
                <section>
                    <h3>15. Organize and clarify the network - cont'd </h3>
                    <p><highlight>Do the same but for the blue nodes:</highlight></p>
                    <img style="float:right;width:35%" src="./figures/em_clarify3.png">

                    <ol style="list-style-type:lower-roman;width:55%" start=12>
                        <li>Go back to the <b>Control Panel</b> Select tab, adjust slider to select all negative values. Click on <b>Apply</b> at the bottom of the Select tab. 
                        </li>
                        <li>All blue nodes should now be selected. Click and hold on any selected node and drag selection to the right until it does not overlap any red nodes. </li>
                        <li>Select <b>Layouts</b> from the Cytoscape menu and apply <b>Prefuse Force Directed Layout  -->   Selected Nodes Only  -->  (none)</b>.</li>
                    </ol>
                </section>
                  <section>
                    <h3>Troubleshooting - Organizing Results </h3>
                        <div class="row">    
                          <ul><font color="red"> TROUBLESHOOTING: Which is the best layout to use?</font>
                           <li>There are many different layout algorithms available in Cytoscape that can be used for EnrichmentMap.</li>
                            <li> We recommend using an edge weighted layout, which considers the overlap score between pathways.</li>
                            <li> Most layouts (except yFiles) offer the ability to organize just the selected nodes.</li>
                            <li> Experiment with different layouts to see which works best with your data. If you do not like the resulting layout, press command-Z on macOS or ctrl-Z on Windows or click on Edit --> Undo to revert to the previous view.</li>
                        </ul>           
                        </div>
                </section>   
                <section>
                    <h1>16.	Define major biological themes. </h1>
                    <p>Enrichment maps typically include clusters of similar pathways representing major biological themes. Clusters can be automatically defined and summarized using the AutoAnnotate Cytoscape app. AutoAnnotate first clusters the network using the clusterMaker2 app and then summarizes each cluster based on word frequency within the pathway names via the WordCloud app.</p>
                    <img style="float:right;width:35%" src="./figures/em_clarify4.png">

                    <ol style="list-style-type:lower-roman;width:55%" start=1>
                        <li>From the Cytoscape menu bar, launch AutoAnnotate by selecting <b>Apps, AutoAnnotate, New Annotation Set…</b></li>
                        <li>The <b>AutoAnnotate: Create Annotation Set</b> panel will appear. </li>
                        <li>In the <b>Quick Start</b> tab click on <b>Create Annotations</b>. </li>
                    </ol>
                </section>
                
                  <section>
                    <h3>Troubleshooting - Defining major themes </h3>
                        <div class="row">    
                          <ul><font color="red"> TROUBLESHOOTING: Labels contain uninformative words.</font>
                           <li>Node names contain uninformative words that are not excluded by default or are not considered during network normalization.</li>
                            <li> If particular non-informative words keep appearing in the labels generated by AutoAnnotate, try adjusting the WordCloud normalization factor. </li>
                            <li> The significance of each word is calculated based on the number of occurrences in the given cluster of pathways. </li>
                            <li> This causes frequent words such as “pathway” or “regulation” to be prominent. By increasing the normalization factor, we reduce the priority of such recurrent words in cluster labels. If that doesn’t help, you can add the non-informative words to the WordCloud word exclusion list.</li>
                        </ul>        
                        </div>
                </section>   
                
                <section>
                    <h3>16.	Define major biological themes - cont'd </h3>
                    <img style="float:right;width:55%" src="./figures/em_clarify5.png">

                    <ol style="list-style-type:lower-roman;width:35%" start=4>
                        <li>Each cluster in the network will have a circle annotation drawn around it and will be associated with a set of words (by default three) that correspond to the most frequent node labels in the cluster.
                            <ol style="list-style-type:disc">
                                <li>These words are automatically selected and often must be manually renamed (see Step 18iii).</li>
                                <li>Moving individual nodes within a cluster will automatically resize the surrounding circle and moving an entire cluster will redraw the surrounding circle in the new cluster location.</li>
                            </ol>   
                        </li>
                    </ol>
                </section>
                
                 <section>
                    <h3>Troubleshooting - Defining major themes </h3>
                        <div class="row">    
                           <ul><font color="red"> TROUBLESHOOTING: Labels are bigger for bigger clusters but I want all the labels to be the same size.</font>
                           <li>Setting to scale labels to the size of the cluster is enabled.</li>
                            <li> The number of nodes in a cluster determines label size by default. Thus, the cluster size may relate to pathway popularity instead of importance in the experiment. Annotation labels can all be set to the same size by unchecking the option “Scale font by cluster size” in the AutoAnnotate results panel. </li>
                        </ul>         
                        </div>
                </section>   
                
                
                <section>
                    <h3>16.	Define major biological themes - cont'd </h3>
                    <img src="./figures/em_clarify6.png">

                    <ol style="list-style-type:lower-roman" start=5>
                        <li>Manually arrange clusters to clean up the figure. Move nodes to reduce node and label overlap. Figure above shows the results of this process.                        
                        </li>
                    </ol>
                </section>
                 <section>
                    <h1>17.	Create a simplified network view  </h1>
                    <p>This creates a single group node for every cluster with a summarized name and provides an overview of the enrichment result themes that is useful for enrichment maps containing many nodes.</p>
                    <img style="float:right;width:35%" src="./figures/em_clarify7.png">

                    <ol style="list-style-type:lower-roman;width:35%" start=1>
                        <li>In <b>Control Panel</b> select the <b>AutoAnnotate </b> tab.</li>
                        <li>Click on the Menu icon in the upper right corner. </li>
                        <li>Select <b>Collapse All</b>. </li>
                    </ol>
                </section>
                
            
                <section>
                    <h3>17.	Create a simplified network view - cont'd </h3>
                    <p><highlight>Scale collapsed network for better viewing:</highlight></p>
                    <img style="float:right;width:35%" src="./figures/em_clarify8.png">

                    <ol style="list-style-type:lower-roman;width:35%" start=4>
                        <li>In the Cytoscape menu bar, select <b>View --> Show Tool Panel</b>.</li>
                        <li>Go to the Node Layout Tools panel located at the bottom of the <b>Control Panel</b>.</li>
                        <li>Locate the <b>Scale</b> slider bar and use it on unselected nodes (uncheck Selected only).</li>
                        <li>Move slider left to tighten the node spacing. Close the Node Layout Tools panel when finished.</li>
                    </ol>
                </section>
                
                 <section>
                    <h3>Troubleshooting - Creating simplified network view </h3>
                        <div class="row">    
                          <ul><font color="red"> TROUBLESHOOTING: Pop up after selecting "Collapse all" shows up everytime I collapse my clusters.</font>
                           <li>Have not specified "Don't ask me again" option on pop up.</li>
                            <li>Once you click on “Collapse All” a pop-up window will show the message “Before collapsing clusters please go to the menu Edit->Preferences->Group preferences and select “Enable attribute aggregation”. There is no need to adjust this parameter repeatedly. Click on “Don’t ask me again” and “OK” if you have set this parameter previously. </li>
                        </ul>       
                   
                        <ul><font color="red"> TROUBLESHOOTING: Collapsing my network takes a long time.</font>
                           <li>The larger the network or the more clusters in a network, the longer collapsing will take. </li>
                            <li>For large networks, collapsing and expanding may take time. For a quick view of the collapsed network you can create a summary network by selecting the “Create summary Network…”. There are two options for the summary network: “clusters only” which creates a summary network with just the circled clusters, or “clusters and unclustered nodes” which creates a summary network that also includes the singleton nodes not part of any cluster. </li>
                        </ul>
                            <ul><font color="red"> TROUBLESHOOTING: Collapsed network contain grey nodes instead of colored as they were in the pre-collapsed network.</font>
                           <li>Attribute aggregation in not enabled. </li>
                            <li>If the nodes in the resulting collapsed network are grey then you forgot to enable attribute aggregation. Expand clusters and before collapsing clusters again, go to the menu Edit->Preferences->Group preferences and select “Enable attribute aggregation". </li>
                        </ul>       
                        </div>
                </section>   
                
                <section>
                    <h1>18.	Manually arranging the network   </h1>
                    <p>Manually arranging the network nodes and custom labeling the major themes is required for the clearest network view and for a publication quality figure. For instance, it is useful to bring together similar themes, such as signaling or metabolic pathways, even if they are not connected in the map. Use of space should be optimized so that large amounts of white space are not present. <b><font color="purple"> This is a time consuming step, but the more effort spent, the higher quality the resulting figure will be.</font></b></p>
                    <ol style="list-style-type:lower-roman" start=1>
                        <li>If the focus of the figure is only on a subset of the network, it can be easier to work with just the subset.
                            <ol style="list-style-type:disc">
                                <li>To create this, select the nodes of interest, then in the Cytoscape menu bar select <b>File --> New --> Network --> From selected nodes --> all edges</b></li>
                                <li>or alternatively use the corresponding icon in the Cytoscape tools menu bar (<b>New network from selection, (all edges)</b>).</li>
                            </ol>  
                        </li>
                    </ol>
                </section>
                
                <section>
                    <h3>18.	Manually arranging the network - cont'd  </h3>
                    
                    <ol style="list-style-type:lower-roman" start=2>
                        <li>When the purpose of the figure is to show a large network and highlight only the main themes, 
                            <ol style="list-style-type:disc">
                                <li>clicking on <b>Publication ready</b> located at the bottom of the <b>EM Control panel</b> will remove node labels.</li>
                                <li>To revert to the original network, click on the <b>Publication ready</b> button again.  </li>
                            </ol>
                        </li>
                        <li>Automatic WordCloud-generated theme names are useful for quickly exploring an enrichment map, but frequently need to be renamed for publication quality figures.
                            <ol style="list-style-type:disc">
                                <li> Naming should carefully consider all pathways and genes within each theme.</li>
                                <li>Themes can be renamed in AutoAnnotate by right-clicking the name in the AutoAnnotate panel in the “<b>Cluster</b>” column, and selecting <b>Rename…</b> </li>
                                <li>Alternatively, labels can be changed in external drawing software (see Step 20). Note that re-clustering the network will reset theme names.</li>
                            </ol>
                        </li>
                    </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - Arranging Network </h3>
                        <div class="row">    
                          <ul><font color="red"> TROUBLESHOOTING: In the EnrichmentMap input panel, the bottom options  "Publication Ready" and "Set Signature Edge Width" are not visible. </font>
                           <li>The Node Layout Tool is open. </li>
                            <li>Close the Node Layout Tools window using the x symbol located at the top right corner.  </li>
                        </ul>       
                        </div>
                </section>   
                
                <section>
                    <h1>19.	Create a subnetwork  </h1>
                    <p>Create a subnetwork that highlights a specific theme subset. Enrichment maps of rich omics data sets are often large and complicated and it is often useful to emphasize specific themes or relevant pathways in a final figure. For example, we will select the top mesenchymal and immunoreactive pathways and create a subnetwork for detailed visualization.</p>
                    <img style="float:right;width:35%" src="./figures/em_clarify9.png">
                    <ol style="list-style-type:lower-roman;width:55%" start=1>
                        <li>Click on the <b>Select tab</b> in the <b>Control Panel</b>.</li>
                        <li>Click on the + symbol and select Column filter.</li>
                        <li>Click on <b>Choose column…</b> and select “<b>EM1_NES (Mesem_vs_Immuno)</b>”.</li>
                        <li>Click on the box next to <b>between</b> and replace the negative value by 2.5. Do not change the positive value next to <b>inclusive</b>. Click <b>Enter</b>.</li>
                    </ol>
                    
                </section>
                
                <section>
                    <h3>19.	Create a subnetwork - cont'd  </h3>
                    <img style="float:right;width:35%" src="./figures/em_clarify10.png">
                    <ol style="list-style-type:lower-roman;width:55%" start=5>
                        <li>Click on the + symbol and select Column filter.</li>
                        <li>Click on <b>Choose column…</b> and select “<b>EM1_NES (Mesem_vs_Immuno)</b>”.</li>
                        <li>Click on the box next to <b>inclusive</b> and change the value to -2.5. Do not change the negative value next to <b>between</b>. Click <b>Enter</b>.</li>
                        <li>Above the two column filters you just added, change the drop down from <b>Match all (AND)</b> to <b>Match any (OR)</b>.</li>
                        <li>Click on <b>Apply</b>. Under the apply button, it should display the number of nodes and edges selected. In this example, 32 nodes should be selected.</li>
                    </ol>
                </section>
                
                <section>
                    <h3>19.	Create a subnetwork - cont'd  </h3>
                    <img  src="./figures/em_subnetwork.png">
                    <ol style="list-style-type:lower-roman;" start=10>
                        <li>From the Cytoscape menu, Select <b>File --> New --> Network --> From selected nodes, all edges</b>.</li>
                        <li>A new smaller network should appear. Manually move nodes around to optimize the layout.</li>
                        <li>Annotate the network as described in Step 16 </li>
                    </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - Create subnetwork </h3>
                        <div class="row">    
                          <ul><font color="red"> TROUBLESHOOTING: The created subnetwork is empty. </font>
                           <li>Nodes were not selected prior to the creation of the subnetwork. </li>
                            <li>Make sure that the nodes that will be part of the subnetwork are selected before creation of the subnetwork.  </li>
                        </ul>     
                        </div>
                </section>   
                
                <section>
                    <h1>20. Export an image	</h1>
                    <img src="./figures/em_save.png">
                    <ol style="list-style-type:lower-roman" start=1>
                        <li>In the Cytoscape menu bar, select <b>File --> Export as Image…</b></li>
                        <li>Set the <b>Export File Format</b> to PDF (*.pdf).</li>
                        <li>Click on <b>Browse…</b> to specify file name and location.</li>
                        <li>Click on <b>Save</b> to close the browser window and then on <b>OK</b>.</li>
                    </ol>
                </section>
                
                  <section>
                    <h3>Troubleshooting - Export image </h3>
                        <div class="row">    
                          <ul><font color="red"> TROUBLESHOOTING: Exported image only contains a small subset of my network.</font>
                           <li>Only what is visible in the view is exported. </li>
                            <li>In image export, only the visible part of the map will be exported. Make sure that the entire network is visible on your screen before exporting. </li>
                        </ul>       
                        </div>
                </section>   
                
                <section>
                    <h1>21. Identify network creation parameters</h1>
                    <p>Identify network creation parameters. In the previous step we exported the network as an image, but the parameters used to create the map are needed to interpret and reproduce the image.</p>
                    <img style="float:center;width:85%" src="./figures/em_params.png">
                    <ol style="list-style-type:lower-roman" start=1>
                        <li>In the <b>Control Panel</b>, locate the EnrichmentMap Input panel and click on the cog (settings) icon in the top right-hand corner.</li>
                        <li>Click on <b>show Creation Parameters…</b></li>
                        <li>In the displayed panel you will find the FDR q-value, similarity metric and threshold parameters to be added to the text legend of figure. In this example: “Enrichment map was created with parameters q &lt; 0.01, and Jaccard Overlap combined coefficient &gt; 0.375 with combined constant = 0.5”. </li>
                    </ol>
                </section>
                
                <section>
                    <h3>Troubleshooting - Identify network creation parameters</h3>
                        <div class="row">    
                         <ul><font color="red"> TROUBLESHOOTING: The parameters shown do not match what I expected them to be.</font>
                           <li>The creation parameters panel only shows the parameters that were used at network creation. If you modified the network using filters or the EnrichmentMap slider bars you will have to update the thresholds accordingly.</li>
                        </ul>       
                        </div>
                </section>   
                
                <section>
                    <h1>22. Show and create a legend. </h1>
                    <img style="float:right;width:35%" src="./figures/example_legend.png">
                    <ol style="list-style-type:disc;width:55%">
                        <li>In the <b>Control Panel</b>, locate the <b>EnrichmentMap Input panel</b> and click on the cog icon in the top right corner.</li>
                        <li>Click on <b>Show Legend</b>.</li>
                        <li>The example shows a simplified legend, however many different node and edge attributes like size, shape and color can be used in the enrichment map to represent different aspects of the data.</li>
                        <li><font color="red">It is important to describe them in the text associated with the figure or in the figure itself as a legend.</font></li>
                        <li> The basic legend components (available as SVG and PDF images at <a href="http://baderlab.org/Software/EnrichmentMap#Legends">http://baderlab.org/Software/EnrichmentMap#Legends</a>) that can be used for an enrichment map figure. You can manually select the components relevant to your analysis. </li>
                    </ol>
                       
                </section>
                <section>
                    <h1>23. Save all work as a Cytoscape session </h1>
                    <ol style="list-style-type:disc;width:55%">
                        <li>In the Cytoscape menu, select <b>File --> Save As… </b></li>
                        <li>Navigate to the directory you wish to save the session and specify the desired file name. </li>
                    </ol>
                       
                </section>
                
                
            </section>
            <section>
                    <h1>Acknowledgements </h1>
                    <p>Presentation is based on the publication <b>"Pathway enrichment analysis and visualization of omics data using g:Profiler, GSEA and Cytoscape EnrichmentMap"</b></p>
                    
                     <h5><highlight>Written by:</highlight></h5>
                     <p><b>Jüri Reimand</b>, <b>Ruth Isserlin</b>, Veronique Voisin, Mike Kucera, Christian Tannus-Lopes, Asha Rostamianfar, Lina Wadi, Mona Meyer, Jeff Wong, Changjiang Xu, Daniele Merico, Gary D. Bader</p>
                <div class="footer" style="position: absolute; left: -3em; bottom: -4em; ">
                    <img class="plain" src="../../assets/images/Cytoscape.png" style="height:70px;opacity:0.5"> 
                    <version>3.6.1</version>
                </div>
            </section>
                
                
<!-- THIS IS WHERE YOUR CONTENT ENDS -->
<!-- ========================================================== -->
                        
  		</div>
		</div>

		<script src="../../lib/js/head.min.js"></script>
		<script src="../../js/reveal.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-155159-15', 'auto');
  ga('send', 'pageview');

</script>
<script>
	Reveal.addEventListener( 'ready', function() {
	if(!window.navigator.userAgent.includes('CyBrowser')){
		var divs = document.getElementsByClassName("cybrowser")
		for (var i=0;i<divs.length;i++){
			divs[i].style.display = "none";
		}
	} else {
		var divs = document.getElementsByClassName("not-cybrowser")
		for (var i=0;i<divs.length;i++){
			divs[i].style.display = "none";
		}
	}
});
</script>  
		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,
				controls: true,
				progress: true,
				slideNumber: false,
				touch: true,
				fragments: true,
				help: true,
				showNotes: false,
				previewLinks: false,
				transition: 'slide', // none/fade/slide/convex/concave/zoom
				width: 1200,
				height: 860,
				autoSlide: 0,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
				{ src: '../../plugin/markdown/marked.js' },
				{ src: '../../plugin/markdown/markdown.js' },
				{ src: '../../plugin/markdown/zoom.js', async: true, condition: function(){ return !!document.body.classList; } },
				{ src: '../../plugin/zoom-js/zoom.js', async: true, condition: function(){ return !!document.body.classList; } },
				{ src: '../../plugin/notes/notes.js', async: true },
				{ src: '../../plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
				{ src: '../../plugin/external/external.js', condition: function() { return !!document.querySelector( '[data-external]' ); } }
				]
				});
			</script>
		</body>
	</html>
